<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>eFootball タレントポイントツール</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#60a5fa;--muted:#94a3b8;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;background:linear-gradient(180deg,#071029 0%, #071c2b 100%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:1100px;max-width:100%;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;padding:22px;box-shadow:0 8px 30px rgba(2,6,23,0.7);}
    h1{margin:0 0 8px;font-size:20px}
    .top{display:flex;gap:16px;align-items:center;margin-bottom:12px}
    .panel{background:var(--card);padding:12px;border-radius:10px;flex:1}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="number"],select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .center{display:flex;flex-direction:column;align-items:center;justify-content:center}
    .categories{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
    .cat{background:var(--glass);padding:10px;border-radius:8px}
    .cat h3{margin:0 0 6px;font-size:14px}
    .cat .params{font-size:13px;color:var(--muted);margin-bottom:8px}
    .cat .row{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);border:none;color:#04293a;padding:8px 10px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03);text-align:left}
    th{color:var(--muted);font-size:12px}
    .small{font-size:12px;color:var(--muted)}
    .controls{display:flex;gap:8px;align-items:center}
    .muted{color:var(--muted)}
    .big-number{font-size:20px;font-weight:700}
    .centered{display:flex;align-items:center;justify-content:center}
    .footer{display:flex;gap:8px;justify-content:space-between;align-items:center;margin-top:12px}
    .param-actions{display:flex;gap:6px}
    .params-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
    .param-column{background:var(--glass);padding:10px;border-radius:8px}
    .param-column h4{margin:0 0 8px;font-size:14px}
    .param-row{display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-top:1px dashed rgba(255,255,255,0.02)}
    .param-row:first-of-type{border-top:none}
    .category-summary{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:12px}
    .cat-summary-item{background:rgba(255,255,255,0.02);padding:8px;border-radius:6px;text-align:center}
    @media (max-width:900px){.categories{grid-template-columns:1fr}.params-grid{grid-template-columns:1fr}.category-summary{grid-template-columns:repeat(2,1fr)}}
  </style>
</head>
<body>
  <div class="app" role="application">
    <h1>eFootball — タレントポイント割り振りツール</h1>
    <div class="top">
      <div class="panel" style="max-width:260px">
        <label>選手レベル (1〜99)</label>
        <input id="level" type="number" min="1" max="99" value="50" />
        <p class="small muted">タレントポイント = (レベル - 1) × 2</p>
        <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
          <div>
            <div class="small muted">総タレントポイント</div>
            <div id="totalTalent" class="big-number">0</div>
          </div>
          <div>
            <div class="small muted">残りポイント</div>
            <div id="remainingTalent" class="big-number">0</div>
          </div>
        </div>
      </div>

      <div class="panel center" style="max-width:360px">
        <label>アディショナルポイント</label>
        <div class="small muted" style="margin-top:6px">アディショナルポイントは無制限です。任意のパラメータに何度でも割り振ることができます（-1で戻せます）。</div>
      </div>

      <div class="panel centered" style="max-width:360px">
        <label>操作</label>
        <div style="display:flex;gap:8px">
          <button id="resetAll" class="ghost">リセット(全て)</button>
        </div>
      </div>
    </div>

    <div class="categories" id="categories"></div>

    <div class="category-summary" id="categorySummary"></div>

    <div class="params-grid">
      <div class="param-column" id="leftParams">
        <h4>左側パラメータ</h4>
        <!-- 左側のパラメータリストがここに入ります -->
      </div>
      <div class="param-column" id="rightParams">
        <h4>右側パラメータ</h4>
        <!-- 右側のパラメータリストがここに入ります -->
      </div>
    </div>

    <div class="grid">
      <div class="panel">
        <h3>計算の説明</h3>
        <div class="small muted">
          ・タレントポイントは <code>(レベル - 1) × 2</code> で計算されます。<br>
          ・各カテゴリに割り振ると、該当カテゴリに含まれるパラメータがすべて+1されます。<br>
          ・カテゴリの増加1回ごとのコストは <strong>1,1,1,1,2,2,2,2,3,3,...</strong> のように<br>4回ごとに必要ポイントが1つ増えます（= 次の増加のコストは ceil((現在回数+1)/4)）。<br>
          ・アディショナルポイントは無制限で、任意のパラメータに何度でも割り振れます（-1で戻せます）。<br>
          ・最終補正: 全パラメータに +1、さらに値が56以上なら+1、85以上ならさらに+1。<br>
          ・各項目にはリセットボタンがあります。
        </div>
      </div>

      <div class="panel">
        <h3>操作ヘルプ</h3>
        <div class="small muted">左のカラムは選手のオフェンス/パス/ドリブル系を中心、右のカラムは守備/GK/フィジカル系を中心に並べています。各パラメータは個別に基礎値を編集でき、アディショナルで増減できます。</div>
      </div>
    </div>

    <div class="footer">
      <div class="small muted">配置は中央基準で見やすくデザインしています。静的な1ファイル（index.html）なのでGitHub Pagesでそのまま公開できます。</div>
      <div><small class="muted">作成: KAZOO</small></div>
    </div>
  </div>

  <script>
    // カテゴリ定義 (日本語)
    const CATEGORIES = [
      {id:1,name:'① 決定力系', params:['決定力','プレースキック','カーブ']},
      {id:2,name:'② パス系', params:['グラウンダーパス','フライパス']},
      {id:3,name:'③ ドリブル系', params:['ドリブル','ボールコントロール','ボールキープ']},
      {id:4,name:'④ オフェンス/瞬発系', params:['オフェンスセンス','瞬発力','ボディコントロール']},
      {id:5,name:'⑤ スピード系', params:['キック力','スピード','スタミナ']},
      {id:6,name:'⑥ フィジカル/ヘディング系', params:['ヘディング','ジャンプ','フィジカルコンタクト']},
      {id:7,name:'⑦ 守備系', params:['ディフェンスセンス','ボール奪取','アグレッシブネス','守備意識']},
      {id:8,name:'⑧ GK系', params:['GKセンス','ジャンプ']},
      {id:9,name:'⑨ クリア/ディフレク', params:['クリアリング','ディフレクティング']},
      {id:10,name:'⑩ GKキャッチ系', params:['キャッチング','コラプシング']}
    ];

    // 左右の表示順をユーザー指定の順番に設定
    const LEFT_PARAMS = ['オフェンスセンス','ボールコントロール','ドリブル','ボールキープ','グラウンダーパス','フライパス','決定力','ヘディング','プレースキック','カーブ','ディフェンスセンス','ボール奪取','アグレッシブネス'];
    const RIGHT_PARAMS = ['守備意識','GKセンス','キャッチング','クリアリング','コラプシング','ディフレクティング','スピード','瞬発力','キック力','ジャンプ','フィジカルコンタクト','ボディコントロール','スタミナ'];

    // 全パラメータの集合（左+右）
    const paramNames = Array.from(new Set([...LEFT_PARAMS, ...RIGHT_PARAMS]));

    // 状態
    const state = {
      level: 50,
      base: {}, // base values per param
      categoryCount: {}, // how many times each category has been increased
      additional: {}, // per param additional assigned (無制限)
      remainingTalent: 0
    };

    // 初期基礎値: デフォルト50、ただし指定されたGK系は40
    paramNames.forEach(p=>{ state.base[p] = 50; state.additional[p] = 0; });
    ['GKセンス','キャッチング','クリアリング','コラプシング','ディフレクティング'].forEach(p=>{ if(state.base[p]!==undefined) state.base[p]=40; });
    CATEGORIES.forEach(c=> state.categoryCount[c.id] = 0);

    // コスト関数: 次の1回に必要なポイント
    function costForNext(catCount){
      return Math.ceil((catCount+1)/4);
    }

    function calcTotalTalent(level){
      return Math.max(0, (Number(level)-1)*2);
    }

    // UI要素
    const categoriesEl = document.getElementById('categories');
    const categorySummaryEl = document.getElementById('categorySummary');
    const leftParamsEl = document.getElementById('leftParams');
    const rightParamsEl = document.getElementById('rightParams');
    const levelInput = document.getElementById('level');
    const totalTalentEl = document.getElementById('totalTalent');
    const remainingTalentEl = document.getElementById('remainingTalent');

    function renderCategories(){
      categoriesEl.innerHTML = '';
      CATEGORIES.forEach(cat=>{
        const div = document.createElement('div'); div.className='cat';
        const h = document.createElement('h3'); h.textContent = cat.name; div.appendChild(h);
        const p = document.createElement('div'); p.className='params'; p.textContent = cat.params.join('、'); div.appendChild(p);
        const row = document.createElement('div'); row.className='row';
        const info = document.createElement('div'); info.style.flex='1';
        info.innerHTML = `<div class="small muted">増加回数: <strong id="c${cat.id}count">${state.categoryCount[cat.id]}</strong></div>
        <div class="small muted">次の増加コスト: <strong id="c${cat.id}cost">${costForNext(state.categoryCount[cat.id])}</strong></div>`;
        row.appendChild(info);
        const btn = document.createElement('button'); btn.textContent='+1 割り振る';
        btn.addEventListener('click', ()=>{ allocateCategory(cat.id,1); });
        row.appendChild(btn);
        const minusBtn = document.createElement('button'); minusBtn.className='ghost'; minusBtn.textContent='-1';
        minusBtn.addEventListener('click', ()=>{ removeCategory(cat.id); });
        row.appendChild(minusBtn);
        const resetBtn = document.createElement('button'); resetBtn.className='ghost'; resetBtn.textContent='リセット';
        resetBtn.addEventListener('click', ()=>{ resetCategory(cat.id); });
        row.appendChild(resetBtn);
        div.appendChild(row);
        categoriesEl.appendChild(div);
      });
    }

    function renderCategorySummary(){
      categorySummaryEl.innerHTML = '';
      CATEGORIES.forEach(cat=>{
        const it = document.createElement('div'); it.className='cat-summary-item';
        it.innerHTML = `<div style="font-size:12px;color:var(--muted)">${cat.name}</div><div style="font-weight:700;font-size:16px" id="sum${cat.id}">${state.categoryCount[cat.id]}</div>`;
        categorySummaryEl.appendChild(it);
      });
    }

    function makeParamRow(param){
      const row = document.createElement('div'); row.className='param-row';
      const left = document.createElement('div'); left.style.display='flex'; left.style.alignItems='center'; left.style.gap='8px';
      const name = document.createElement('div'); name.textContent = param; name.style.minWidth='120px';
      const baseInput = document.createElement('input'); baseInput.type='number'; baseInput.value=state.base[param]; baseInput.style.width='72px';
      baseInput.addEventListener('change', ()=>{ state.base[param]=Number(baseInput.value); updateAll(); });
      left.appendChild(name); left.appendChild(baseInput);

      const right = document.createElement('div'); right.style.display='flex'; right.style.alignItems='center'; right.style.gap='8px';
      const catCon = document.createElement('div'); catCon.className='small muted'; catCon.textContent = 'カテゴリ増加: ' + categoryContributionForParam(param);
      const addCon = document.createElement('div'); addCon.className='small muted'; addCon.textContent = 'アディショナル: ' + state.additional[param];
      const raw = document.createElement('div'); raw.className='small muted'; raw.textContent = '素の合計: ' + rawForParam(param);
      const finalV = document.createElement('div'); finalV.className='small'; finalV.textContent = finalForParam(param);
      // 強調表示
      finalV.style.fontWeight = '700'; finalV.style.fontSize='14px';
      const fv = finalForParam(param);
      finalV.style.color = getFinalColor(fv);

      const plusBtn = document.createElement('button'); plusBtn.textContent='+1'; plusBtn.addEventListener('click', ()=>{ allocateAdditional(param,1); });
      const minusBtn = document.createElement('button'); minusBtn.className='ghost'; minusBtn.textContent='-1'; minusBtn.addEventListener('click', ()=>{ allocateAdditional(param,-1); });
      const resetBtn = document.createElement('button'); resetBtn.className='ghost'; resetBtn.textContent='リセット'; resetBtn.addEventListener('click', ()=>{ resetParam(param); });

      right.appendChild(catCon); right.appendChild(addCon); right.appendChild(raw); right.appendChild(finalV); right.appendChild(plusBtn); right.appendChild(minusBtn); right.appendChild(resetBtn);

      row.appendChild(left); row.appendChild(right);
      return row;
    }

    function getFinalColor(v){
      // カラーコード: 赤:#ff0000, オレンジ:#ffc700, 緑:#5cff00, 青:#00ffd2
      if(v < 70) return '#ff0000';
      if(v < 80) return '#ffc700';
      if(v < 90) return '#5cff00';
      return '#00ffd2';
    }

    function renderParamColumns(){
      leftParamsEl.querySelectorAll('.param-row').forEach(n=>n.remove());
      rightParamsEl.querySelectorAll('.param-row').forEach(n=>n.remove());
      LEFT_PARAMS.forEach(p=>{ leftParamsEl.appendChild(makeParamRow(p)); });
      RIGHT_PARAMS.forEach(p=>{ rightParamsEl.appendChild(makeParamRow(p)); });
    }

    function categoryContributionForParam(param){
      // Sum of category increments for categories that contain this param
      let sum=0;
      CATEGORIES.forEach(c=>{ if(c.params.includes(param)) sum += state.categoryCount[c.id]; });
      return sum;
    }

    function rawForParam(param){
      return Number(state.base[param]) + categoryContributionForParam(param) + Number(state.additional[param]);
    }

    function finalForParam(param){
      let v = rawForParam(param);
      v = v + 1; // global +1
      if(v >= 56) v = v + 1;
      // 正しくは85以上でさらに+1
      if(v >= 85) v = v + 1;
      return v;
    }

    function allocateCategory(catId, times){
      for(let i=0;i<times;i++){
        const cost = costForNext(state.categoryCount[catId]);
        if(state.remainingTalent >= cost){
          state.categoryCount[catId] += 1;
        } else {
          alert('残りタレントポイントが足りません');
          break;
        }
      }
      updateAll();
    }

    function removeCategory(catId){
      if(state.categoryCount[catId] > 0){
        state.categoryCount[catId] -= 1;
        updateAll();
      } else {
        alert('これ以上減らせません');
      }
    }

    function resetCategory(catId){
      state.categoryCount[catId]=0;
      updateAll();
    }

    function allocateAdditional(param, delta){
      if(delta>0){
        state.additional[param] += delta; // 無制限に増加
      } else {
        const canRemove = Math.min(state.additional[param], -delta);
        if(canRemove<=0){ alert('これ以上アディショナルを減らせません'); return; }
        state.additional[param] -= canRemove;
      }
      updateAll();
    }

    function resetParam(param){
      state.additional[param]=0; updateAll();
    }

    function resetAll(){
      if(!confirm('本当に全てリセットしますか？')) return;
      state.level = 50; levelInput.value = 50;
      paramNames.forEach(p=>{ state.base[p]=50; state.additional[p]=0; });
      ['GKセンス','キャッチング','クリアリング','コラプシング','ディフレクティング'].forEach(p=>{ if(state.base[p]!==undefined) state.base[p]=40; });
      CATEGORIES.forEach(c=> state.categoryCount[c.id]=0);
      updateAll();
    }

    function updateAll(){
      state.level = Number(levelInput.value);
      const total = calcTotalTalent(state.level);
      let spent=0; for(const id in state.categoryCount){ const cnt = state.categoryCount[id]; for(let n=1;n<=cnt;n++) spent += Math.ceil(n/4); }
      state.remainingTalent = total - spent;
      if(state.remainingTalent < 0) state.remainingTalent = 0;
      totalTalentEl.textContent = total;
      remainingTalentEl.textContent = state.remainingTalent;

      CATEGORIES.forEach(c=>{
        const cntEl = document.getElementById(`c${c.id}count`);
        const costEl = document.getElementById(`c${c.id}cost`);
        if(cntEl) cntEl.textContent = state.categoryCount[c.id];
        if(costEl) costEl.textContent = costForNext(state.categoryCount[c.id]);
        const sumEl = document.getElementById(`sum${c.id}`);
        if(sumEl) sumEl.textContent = state.categoryCount[c.id];
      });

      renderParamColumns();
      renderCategorySummary();
    }

    document.getElementById('resetAll').addEventListener('click', resetAll);
    levelInput.addEventListener('change', updateAll);

    // 初期レンダリング
    renderCategories();
    updateAll();

  </script>
</body>
</html>
